<script
  src="https://checkout.stripe.com/checkout.js" class="stripe-button"
  data-image="https://stripe.com/img/documentation/checkout/marketplace.png"
  data-zip-code="true">
</script>

<div class="content">
  <div class="formulaire">
      <h4>Information à saisir</h4>
    <form #formCommande="ngForm" novalidate class=""><!--  -->
      <legend>Identification</legend>
      <div class="form-group">
        <div class="d-flex justify-content-between">
          <label for="firstname">Prénom :</label>
          <input type="text" [(ngModel)]="commande.firstname" name="firstname" minlength="3" placeholder="votre prénom" required #firstname="ngModel" (focus)="firstname_finishchanged=false" (focusout)="firstname_finishchanged=true">
        </div>
        <div *ngIf="!firstname.valid && (firstname.dirty || formCommande.submitted ) && firstname_finishchanged"><!-- && firstname.getClass('finishchanged') -->
          Prénom requis (3 caractères minimum)
        </div>
      </div>
      <div class="form-group">
        <div class="d-flex justify-content-between">
          <label for="lastname">Nom :</label>
          <input type="text" [(ngModel)]="commande.lastname" name="lastname" minlength="3" placeholder="votre nom" required #lastname="ngModel" (focus)="lastname_finishchanged=false" (focusout)="lastname_finishchanged=true">
        </div>
        <div *ngIf="!lastname.valid && (lastname.dirty || formCommande.submitted ) && lastname_finishchanged">
          Nom requis (3 caractères minimum)
        </div>
      </div>
      <div class="form-group">
        <div class="d-flex justify-content-between">
          <label for="email">Email :</label>
          <input type="email" [(ngModel)]="commande.email" name="email" minlength="3" placeholder="votre email" required #email="ngModel" (focus)="email_finishchanged=false" (focusout)="email_finishchanged=true">
        </div>
        <div *ngIf="!email.valid && (email.dirty || email.touched || formCommande.submitted ) && email_finishchanged">
          Email incorrect (@ et . obligatoire)
        </div>
      </div>
      <!-- <div class="form-group">
        <div class="d-flex justify-content-between">
          <label for="email">Confirmation de votre email :</label>
          <input type="text" [(ngModel)]="emailconfirm" name="email" minlength="3" placeholder="votre email" required #emailconfirm="ngModel">
        </div>
        <div *ngIf="!emailconfirm.valid && (emailconfirm.dirty || formCommande.submitted )">
          Confirmation de l'email non identique à l'email saisie.
        </div>
      </div> -->
      <legend>Adresse</legend>
      <div class="form-group">
        <div class="d-flex justify-content-between">
          <label for="adresse">Adresse :</label>
          <input type="text" [(ngModel)]="commande.adresse" name="adresse" minlength="3" placeholder="n°, rue" required #adresse="ngModel" (focus)="adresse_finishchanged=false" (focusout)="adresse_finishchanged=true" >
        </div>
        <div *ngIf="!adresse.valid && (adresse.dirty || formCommande.submitted ) && adresse_finishchanged" class="alert alert-danger">
          Adresse requise.
        </div>
      </div>
      <div class="form-group">
        <div class="d-flex justify-content-between">
          <label for="postalcode">Code postal :</label>
          <input type="text" [(ngModel)]="commande.postalcode" name="postalcode" minlength="5" placeholder="votre code postal" required #postalcode="ngModel" (focus)="postalcode_finishchanged=false" (focusout)="postalcode_finishchanged=true" value="12345">
        </div>
        <div *ngIf="!postalcode.valid && (postalcode.dirty || formCommande.submitted ) && postalcode_finishchanged" class="alert alert-danger">
          Code postal requis.
        </div>
      </div>
      <div class="form-group">
        <div class="d-flex justify-content-between">
          <label for="city">Ville :</label>
          <input type="text" [(ngModel)]="commande.city" name="city" minlength="3" placeholder="votre ville" required #city="ngModel" (focus)="city_finishchanged=false" (focusout)="city_finishchanged=true"  value="MaVille">
        </div>
        <div *ngIf="!city.valid && (city.dirty || formCommande.submitted ) && city_finishchanged">
          Ville requise dans l'adresse.
        </div>
      </div>
      <legend>Optionnel</legend>
      <div class="form-group">
        <div class="d-flex justify-content-between">
          <label for="adresse">Vos commentaires :</label>
          <input type="text" [(ngModel)]="commande.comment" name="comment"  #adresse="ngModel" value="Si je veux mettre des commentaires">
        </div>
      </div>
      <button class="mx-auto"  (click)="onSubmitCommande(formCommande.value)">Valider la commande</button><!-- [disabled]="!formCommande.valid" -->
    </form>
  </div>
  <div class="table_recap">
    <h4>Recapitulatif</h4>
    <table >
      <thead>
        <tr>
          <th>Références</th>
          <th>Quantité (kg)</th>
          <th>Total HT</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="!products">
          <td colspan="4"><div>Aucun articles dans votre panier</div></td>
        </tr>
        <tr *ngFor="let product of products">
          <td>{{ product.name }}</td>
          <td>
            {{ basket[product.id] }}
          </td>
          <td>{{ basket[product.id] * product.pricekg }} € </td>
        </tr>

        <tr>
          <th>Total HT :</th>
          <td>

          </td>
          <th>{{ totalHT }} €</th>
        </tr>
        <tr>
          <th>+ TVA ({{(tva*100)}}%)</th>
          <td>

          </td>
          <th>{{ tva * totalHT }} €</th>
        </tr>
        <tr>
          <th>Total TTC :</th>
          <td>

          </td>
          <th>{{ totalHT + (totalHT * tva) }} €</th>
        </tr>
      </tbody>
    </table>
  </div>
</div>


